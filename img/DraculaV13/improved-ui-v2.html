<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Le Château de Dracula - Interface Améliorée</title>
  <style>

    /* Reset & Bases */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background-color: #000;
      font-family: "Georgia", serif;
      color: #ccc;
      line-height: 1.6; /* Légèrement augmenté */
      font-size: 0.95rem; /* Taille de base */
    }

    /* Layout */
    #ui-container {
      display: grid;
      grid-template-columns: 1fr 300px; /* Sidebar un peu plus large ? Ajuste si besoin */
      grid-template-rows: auto 1fr;
      grid-template-areas:
        "header header"
        "content sidebar";
      min-height: 100vh;
      background-color: #111;
    }
    .game-header {
      grid-area: header;
      background-color: #1a0000;
      border-bottom: 2px solid #600;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .game-content {
      grid-area: content;
      position: relative;
      overflow: hidden; /* Changé pour éviter double scrollbar */
      padding: 0;
      height: calc(100vh - 72px); /* Ajusté pour header padding (approximatif) */
    }
    #locations-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      opacity: 0.35; /* Légèrement réduit */
      z-index: 0;
      transition: opacity 0.8s ease, background-image 1s ease;
    }


    /* --- Styles Corrigés pour le cadre texte --- */
    .content-wrapper {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 1200px;
        /* Ajuste cette valeur pour la hauteur désirée */
        max-height: 30vh;  /* Exemple de hauteur */
        background-color: rgba(10, 0, 0, 0.75); /* Légèrement plus opaque */
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 25px rgba(255,0,0,0.4);
        color: #e0e0e0;
        z-index: 1;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
        overflow: hidden; /* Pour contenir les enfants */
    }

    .text-container {
        flex: 1; /* Prend l'espace vertical disponible */
        overflow-y: auto; /* Ajoute scrollbar si texte dépasse */
        width: 100%;
        padding-right: 15px; /* Espace pour scrollbar */
        padding-left: 5px;
        box-sizing: border-box;
    }

    #locations-title {
        font-size: 1.8rem;
        margin-bottom: 15px;
        color: #ff5555; /* Couleur un peu plus vive */
        text-shadow: 1px 1px 3px #000;
        border-bottom: 1px solid #700; /* Ligne plus subtile */
        padding-bottom: 10px;
        width: 100%;
        box-sizing: border-box;
        flex-shrink: 0; /* Empêche le titre de rétrécir */
    }

    #locations-description {
        width: 100%;
        max-width: none;
        margin-bottom: 20px;
        text-align: justify;
        white-space: pre-wrap;   /* Conserve les retours à la ligne du JS */
        padding: 0;
        box-sizing: border-box;
        line-height: 1.6;
        /* Pas de flex: 1 ici, il doit prendre sa hauteur naturelle */
    }

    #choices-container {
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        flex-shrink: 0; /* Empêche les choix de rétrécir */
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-top: auto; /* Pousse les choix vers le bas si peu de texte */
    }
    /* --- Fin Styles Corrigés --- */


    .game-sidebar {
      grid-area: sidebar;
      background-color: #1a0000;
      border-left: 2px solid #600;
      padding: 20px;
      overflow-y: auto;
       height: calc(100vh - 72px); /* Ajusté pour header */
    }

    /* Header */
    .header-left { display: flex; align-items: center; gap: 20px; }
    #player-portrait {
      width: 50px; height: 50px; /* Légèrement réduit */
      border-radius: 50%;
      background-color: #300;
      border: 2px solid #900;
      background-size: cover;
      background-position: center;
      flex-shrink: 0;
    }
    .player-stats { display: flex; flex-direction: column; gap: 4px; } /* Espace réduit */
    #character-name { font-size: 1rem; color: #f55; margin-bottom: 1px; font-weight: bold; } /* Ajusté */
    .health-container { font-size: 0.85rem; color: #ccc; } /* Ajusté */
    .health-container span { font-weight: bold; color: #fff; }
    .stats-line { font-size: 0.8rem; color: #aaa; } /* Ajusté */
    .stats-line span { margin-right: 8px; } /* Ajusté */
    .stats-line span span { color: #fff; font-weight: bold; margin-left: 2px; }
    .header-buttons { display: flex; gap: 10px; }
    .header-button {
      background-color: #400;
      color: #fff;
      border: 1px solid #600;
      border-radius: 4px;
      padding: 6px 10px; /* Ajusté */
      cursor: pointer;
      transition: background 0.3s, transform 0.1s;
      font-size: 0.85rem; /* Ajusté */
      font-family: "Georgia", serif;
    }
    .header-button:hover { background-color: #600; }
    .header-button:active { transform: scale(0.95); }

    /* Choices Styling */
    .choice, .choice-button {
      background: linear-gradient(to bottom, #500, #300); /* Moins intense */
      color: #eee;
      border: 1px solid #700;
      border-radius: 5px;
      padding: 10px 15px; /* Ajusté */
      font-size: 0.9rem; /* Ajusté */
      text-align: left;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4); /* Réduit */
    }
    .choice:hover, .choice-button:hover {
      background: linear-gradient(to bottom, #700, #500);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(128, 0, 0, 0.5); /* Réduit */
    }
    .choice:disabled, .choice-button:disabled,
    .choice.disabled, .choice-button.disabled {
      background: linear-gradient(to bottom, #444, #222);
      color: #777; /* Moins contrasté */
      cursor: not-allowed;
      transform: none;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      border-color: #555;
    }
    .choice-text { font-weight: normal; }
    .requirement {
      font-size: 0.75em; /* Plus petit */
      color: #aaa;
      margin-top: 4px;
      font-style: italic;
    }

    /* Sidebar */
    .sidebar-section {
      background-color: rgba(48, 0, 0, 0.6); /* Moins opaque */
      border: 1px solid #500; /* Moins intense */
      margin-bottom: 15px;
      border-radius: 4px;
      overflow: hidden;
    }
    .sidebar-section h3 {
      background-color: #500; /* Moins intense */
      margin: 0;
      padding: 8px 15px; /* Ajusté */
      font-size: 1rem; /* Ajusté */
      color: #fff;
      font-variant: small-caps;
      letter-spacing: 1px;
    }
    .sidebar-section-content {
      padding: 12px 15px; /* Ajusté */
      font-size: 0.9rem; /* Ajusté */
    }
    .sidebar-section-content ul {
      list-style: none;
      padding-left: 0;
    }
    .sidebar-section-content li {
      margin-bottom: 6px; /* Ajusté */
      padding: 3px 0; /* Ajusté */
      cursor: default;
      transition: color 0.2s;
      border-bottom: 1px solid rgba(128, 0, 0, 0.15); /* Plus subtil */
    }
    .sidebar-section-content li:last-child {
      border-bottom: none;
    }
    .sidebar-section-content li[data-tooltip]:hover {
      color: #ffaaaa; /* Plus clair */
      cursor: help;
    }
    #visited-locations li {
      cursor: pointer;
    }
    #visited-locations li:hover {
      color: #ffaaaa; /* Plus clair */
      text-decoration: underline;
    }

    /* Tooltip Style */
    [data-tooltip] {
      position: relative;
    }
    [data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%) translateX(10px);
      background-color: rgba(0,0,0,0.9);
      color: #fff;
      padding: 6px 10px; /* Ajusté */
      border-radius: 4px;
      font-size: 0.8em; /* Ajusté */
      white-space: nowrap;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
      pointer-events: none;
    }
    [data-tooltip]:hover::after {
      opacity: 1;
      visibility: visible;
    }
	@keyframes pulseAura {
  0%, 100% {
    filter: drop-shadow(0 0 3px #330000);
    opacity: 0.85;
  }
  50% {
    filter: drop-shadow(0 0 8px #770000);
    opacity: 0.82;
  }
}



@keyframes tremblementSubtil {
  0%   { transform: translate(0px, 0px); }
  20%  { transform: translate(-0.2px, 0.1px); }
  40%  { transform: translate(0.3px, -0.1px); }
  60%  { transform: translate(-0.1px, 0.2px); }
  80%  { transform: translate(0.1px, -0.2px); }
  100% { transform: translate(0px, 0px); }
}

@keyframes flameEffect {
  0%   { transform: scale(1) translateY(0); opacity: 0.3; }
  50%  { transform: scale(1.02) translateY(-1.5%); opacity: 0.5; }
  100% { transform: scale(1) translateY(0); opacity: 0.3; }
}

#immersion-frame {
  position: absolute;
  top: 3vh;
  left: 0;
  width: 100%;
  height: 94vh;
  background: url('https://fluffy-kashata-47db51.netlify.app/img/cadre-gothique-transparent.png') center center no-repeat;
  background-size: cover;
  pointer-events: none;
  z-index: 0.5;

  animation: pulseAura 6s ease-in-out infinite, tremblementSubtil 3s infinite;
  filter: drop-shadow(0 0 5px #330000);
  opacity: 0.9;
}


#wing-left, #wing-right {
  position: absolute;
  top: 3vh;
  width: 15vw;
  height: 94vh;
  background-size: contain;
  background-repeat: no-repeat;
  pointer-events: none;
  z-index: 0.5;
}

#wing-left {
  left: 0;
  background-image: url('img/wing-left.png');
}

#wing-right {
  right: 0;
  background-image: url('img/wing-right.png');
}



  </style>
</head>
<body>
  <div id="ui-container">
    <!-- Entête -->
    <header class="game-header">
      <div class="header-left">
        <div id="player-portrait"></div>
        <div class="player-stats">
          <div id="character-name">Chargement...</div>
          <div class="health-container">
            Santé: <span id="health-value">...</span> / <span id="max-health-value">...</span>
          </div>
          <div class="stats-line">
            <span>RAP: <span id="stat-rapidite">...</span></span>
            <span>COU: <span id="stat-courage">...</span></span>
            <span>FOR: <span id="stat-force">...</span></span>
            <span>HAB: <span id="stat-habilete">...</span></span>
            <span>PSI: <span id="stat-psi">...</span>/<span id="stat-psiMax">...</span></span>
          </div>
        </div>
      </div>
      <div class="header-buttons">
        <button id="save-button" class="header-button">Sauvegarder</button>
        <button id="load-button" class="header-button">Charger</button>
        <button id="audio-toggle" class="header-button">Son</button>
        <button id="back-to-creation" class="header-button">Retour Création</button>
      </div>
    </header>

    <!-- Contenu principal -->
    <main class="game-content">
      <div id="locations-background"></div>
	  <div id="wing-left"></div>
	  <div id="wing-right"></div>
      <div class="content-wrapper">
          <h2 id="locations-title">Titre ici</h2>
          <div class="text-container">
              <p id="locations-description">Texte ici...</p>
          </div>
          <div id="choices-container" class="choices-grid">
              <!-- Les boutons de choix seront insérés ici par JS -->
          </div>
      </div>
    </main>

    <!-- Sidebar -->
    <aside class="game-sidebar">
      <div class="sidebar-section" id="inventory-section">
        <h3>Inventaire</h3>
        <div class="sidebar-section-content">
          <ul id="player-inventory">
            <li>Aucun objet</li>
          </ul>
        </div>
      </div>
      <div class="sidebar-section">
        <h3>Effets Actifs</h3>
        <div class="sidebar-section-content">
          <ul id="active-effects">
            <li>Aucun effet</li>
          </ul>
        </div>
      </div>
      <div class="sidebar-section">
        <h3>Lieux Visités</h3>
        <div class="sidebar-section-content">
          <ul id="visited-locations">
            <li>Aucun lieu</li>
          </ul>
        </div>
      </div>
    </aside>
  </div>

  <!-- Script principal -->
  <script>
    // ===== window.gameData INTÉGRÉ ET CORRIGÉ =====
    window.gameData = {
        locations: {
            'campanile-ruine':{title:"Campanile en ruine",description:`Une clairière abrite les vestiges d’un campanile frappé par la foudre...`,background:null,choices:[{text:"Explorer l’intérieur",destination:"interieur-campanile"},{text:"Retourner sur vos pas",destination:"sentier-est"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'interieur-campanile':{title:"Intérieur du campanile",description:`Les murs sont lézardés et recouverts de lierre...`,background:null,choices:[{text:"Revenir à l’extérieur",destination:"campanile-ruine"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'boudoir-mortuaire':{title:"Boudoir mortuaire",description:`Une pièce élégante et raffinée, pleine de parfums...`,background:null,choices:[{text:"Examiner les cercueils",destination:"examiner-cercueils"},{text:"Revenir dans le couloir",destination:"couloir-superieur"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'chapelle-chateau':{title:"Chapelle du Château",description:`Une ravissante chapelle parfumée d’encens...`,background:null,choices:[{text:"S’approcher de l’autel",destination:"examiner-autel"},{text:"Retourner dans le couloir",destination:"couloir-superieur"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'dedale-necrophages':{title:"Dédale des Nécrophages",description:`Un réseau de tunnels creusés à même la terre...`,background:null,choices:[{text:"Explorer un tunnel au hasard",destination:"explorer-dedale"},{text:"Tenter de revenir sur ses pas",destination:"crypte-dracula"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'cabinet-cire':{title:"Cabinet des Figures de cire",description:`Cet endroit est empli de mannequins d’un réalisme glaçant...`,background:null,choices:[{text:"Examiner les mannequins",destination:"examiner-mannequins"},{text:"Inspecter le chaudron de cire",destination:"examiner-chaudron"},{text:"Retourner sur vos pas (Galerie Est)",destination:"galerie-est"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'portail':{title:"Portail du Château",description:`Vous êtes devant les hautes grilles de fer forgé du Château de Dracula...`,background:"https://raw.githubusercontent.com/brizoss/chateau-dracula-assets/4212d6845a41c07b62959c93f1031dfb97680410/img/porte_du_chateau1.jpg",choices:[{text:"Prendre l'allée vers le nord",destination:"allee"},{text:"Examiner les alentours",destination:"examiner-portail"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'allee':{title:"Allée du Château",description:`L'allée carrossable qui relie le portail à la cour d'honneur...`,background:"https://raw.githubusercontent.com/brizoss/chateau-dracula-assets/4212d6845a41c07b62959c93f1031dfb97680410/img/allée_du_chateau4.jpg",choices:[{text:"Continuer vers le nord",destination:"cour-honneur"},{text:"Explorer le sentier à l'ouest",destination:"sentier-ouest"},{text:"Explorer le sentier à l'est",destination:"sentier-est"},{text:"Retourner au portail",destination:"portail"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'cour-honneur':{title:"Cour d'honneur",description:`Une étroite cour pavée, dominée par la sombre masse du Château.`,background:null,choices:[{text:"Aller vers la porte du Château (nord)",destination:"porte-chateau"},{text:"Descendre vers le jardin (est)",destination:"jardin-contrebas"},{text:"Visiter les dépendances (ouest)",destination:"dependances"},{text:"Emprunter le passage voûté (nord-ouest)",destination:"cour-ecuries"},{text:"Retourner vers l'allée (sud)",destination:"allee"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'porte-chateau':{title:"Porte d'entrée du Château",description:`La grande porte du Château, ornée de gros clous de bronze...`,background:null,choices:[{text:"Frapper à la porte",destination:"frapper-porte"},{text:"Tenter d'ouvrir la porte",destination:"ouvrir-porte"},{text:"Retourner dans la cour d'honneur",destination:"cour-honneur"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'cimetiere':{title:"Cimetière familial",background:"https://fluffy-kashata-47db51.netlify.app/img/chatgpt%20image%201%20avr.%202025,%2023_06_58.png",description:`Des pierres tombales se dressent tout autour...`,choices:[{text:"Examiner les pierres tombales",destination:"examiner-tombes"},{text:"Explorer le caveau au sud-ouest",destination:"caveau-famille"},{text:"Aller vers l'est (retour Sentier Ouest)",destination:"sentier-ouest"},{text:"Prendre le sentier vers le nord",destination:"sentier-nord"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'crypte-dracula':{title:"Crypte de Dracula",description:`Votre état de comte mort vivant vous soumet à certaines règles particulières.\n\nLes voici :\n1) Chaque fois que vous passerez d'un paragraphe à un autre, vous perdrez 2 POINTS DE VIE, contrairement à la plupart des autres héros qui, eux, gagnent des POINTS DE VIE lorsqu'ils abordent un nouveau paragraphe.\n\n2) Ni les MEDICAMENTS ni le TRAITEMENT NATUREL n'auront d'effet sur vous. Votre seule et unique manière de récupérer des POINTS DE VIE consiste à boire le sang de vos victimes, ce qui ne peut se produire qu'au cours d'un combat. Lorsque vous obtiendrez 6 ou 12 en lançant les dés, vous gagnerez autant de POINTS DE VIE qu'en possédera à ce moment-là votre adversaire, le total ne pouvant jamais dépasser 100. (Cette opération ne retire rien à votre adversaire, en dehors de la pénalité normale occasionnée par la blessure et déterminée par les dés.)\n\n3) Vos facultés PSI sont les suivantes :\na) Domination des Petits Animaux ;\nb) Téléportation ;\nc) Transmutation.\n\nLa Domination des Petits Animaux est utile si vous êtes agressé par un animal plus petit qu'un être humain (rat, chien, chat, etc.). Au prix de la perte de 1 point d'énergie PSI (ou de 20 POINTS DE VIE équivalents), vous pouvez neutraliser l'attaque d'un ou de plusieurs animaux. Le sacrifice d'un deuxième point PSI convaincra la créature de combattre désormais pour votre compte. Mais si vous avez asservi un animal de cette manière, chaque combat ultérieur vous obligera à lancer deux dés pour savoir s'il va ou non se retourner contre vous. Il vous faudra obtenir un chiffre supérieur à 4 pour que la créature combatte à vos côtés. Si vous obtenez 4 ou moins, elle s'alliera à votre adversaire pour vous combattre. (Dans ce cas, vous pourrez évidemment neutraliser son attaque en faisant à nouveau appel à votre PSI.\n\nLa Téléportation doit obligatoirement être utilisée pour sortir de votre crypte et peut vous servir à y rentrer tant que vous n'aurez pas découvert le passage secret. La Téléportation vous permet, au cours de votre aventure, de rejoindre directement votre crypte à tout moment, sauf pendant un combat. Dans la pratique, son utilisation vous amène au 5, Lieu 35.\n\nLa Transmutation vous permet d'adopter temporairement, durant un combat, la forme d'une chauve-souris. Sous cet aspect, vous êtes beaucoup plus difficile à atteindre, et votre adversaire devra obtenir 8 ou plus pour y parvenir. En revanche, vous êtes infiniment moins vigoureux, et votre total de FORCE sera provisoirement réduit à 1 (ce qui aura son influence sur le calcul des dommages que vous infligerez à votre adversaire). Reprendre votre forme humaine vous coûtera 1 point de PSI.\nPortes secrètes\n\nA l'intérieur du Château, vous aurez le droit d'ajouter 2 points au chiffre donné par les dés lorsque vous chercherez un passage secret. A l'extérieur du Château, les lieux vous étant moins familiers, vous ne pouvez majorer ce chiffre que de 1 point. Si votre tentative est couronnée de succès, vous serez autorisé à consulter le Tableau des Passages secrets à la page 213.\nEt maintenant, rendez-vous au 5 pour commencer votre aventure.`,background:"https://fluffy-kashata-47db51.netlify.app/img/crypte.jpg",choices:[{text:"Utiliser Téléportation (coûte 1 PSI)",destination:"teleport-options",requiredCharacter:"dracula"},{text:"Examiner le sarcophage",destination:"examiner-sarcophage"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'jardin-contrebas':{title:"Jardin en contrebas",description:`Un jardin envahi par des végétaux toxiques...`,background:null,choices:[{text:"Cueillir des plantes",destination:"cueillir-plantes"},{text:"Remonter vers la cour d'honneur",destination:"cour-honneur"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'caveau-famille':{title:"Caveau de famille",description:`Un petit caveau dissimulé derrière une grille en fer forgé.`,background:null,choices:[{text:"Ouvrir la grille et entrer",destination:"combat-zombie"},{text:"Retourner au cimetière",destination:"cimetiere"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'vestibule':{title:"Vestibule",description:`Le vestibule du Château, décoré de torches...`,background:null,choices:[{text:"Ouvrir la porte à deux battants (Nord)",destination:"galerie-ouest"},{text:"Examiner la table",destination:"examiner-table-vestibule"},{text:"Regarder vers la porte d'entrée (Sud)",destination:"porte-chateau"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'galerie-ouest':{title:"Galerie (partie ouest)",description:`Un long couloir traversant le Château...`,background:null,choices:[{text:"Aller vers la galerie est",destination:"galerie-est"},{text:"Prendre l'escalier en colimaçon",destination:"couloir-superieur"},{text:"Ouvrir la porte nord",destination:"fumoir"},{text:"Retourner vers le vestibule (porte sud)",destination:"vestibule"},{text:"Emprunter le passage étroit (est)",destination:"salle-musique"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'galerie-est':{title:"Galerie (partie est)",description:`Une galerie menant à des pièces secondaires...`,background:null,choices:[{text:"Aller vers la bibliothèque (porte Est)",destination:"bibliotheque"},{text:"Ouvrir la porte Nord 1",destination:"cabinet-cire"},{text:"Ouvrir la porte Nord 2",destination:"salon"},{text:"Retourner vers la galerie ouest",destination:"galerie-ouest"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'fumoir':{title:"Fumoir",description:`Une pièce ornée d'une cheminée imposante...`,background:null,choices:[{text:"Examiner la vitrine d'armes",destination:"examiner-vitrine"},{text:"Aller vers la porte ouest",destination:"salle-manger"},{text:"Aller vers la porte sud",destination:"galerie-ouest"},{text:"Aller vers la porte est",destination:"salon"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'salle-musique':{title:"Salle de musique",description:`Une pièce étroite avec un piano à queue...`,background:null,choices:[{text:"Examiner le piano",destination:"examiner-piano"},{text:"Aller vers la porte nord du mur ouest",destination:"salon"},{text:"Aller vers la porte sud du mur ouest",destination:"galerie-ouest"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'jardin-clos':{title:"Jardin clos",description:`Un jardin fermé et mystérieux, à l'abandon depuis longtemps...`,background:null,choices:[{text:"Chercher une sortie",destination:"chercher-sortie-jardin-clos"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'cour-interieure':{title:"Cour intérieure",description:`Une cour pavée cachée à l'intérieur du Château, entourée d'écuries apparemment vides...`,background:null,choices:[{text:"Chercher une sortie",destination:"chercher-sortie-cour-interieure"},{text:"Visiter les écuries",destination:"cour-ecuries"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'cuisine':{title:"Cuisine",description:`Une cuisine froide et silencieuse, emplie d'ustensiles anciens couverts de poussière...`,background:null,choices:[{text:"Examiner les ustensiles",destination:"examiner-cuisine"},{text:"Sortir par la porte Ouest",destination:"salle-manger"},{text:"Sortir par la porte Sud (vers Galerie Ouest)",destination:"galerie-ouest"},{text:"Monter l'escalier de service (Est)",destination:"couloir-superieur"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'bibliotheque':{title:"Bibliothèque",description:`Cette pièce est à la fois une bibliothèque et un bureau...`,background:null,choices:[{text:"Examiner les livres",destination:"examiner-bibliotheque"},{text:"Examiner le bureau",destination:"examiner-bureau-biblio"},{text:"Retourner à la galerie est (Sud)",destination:"galerie-est"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'salle-manger':{title:"Salle à manger",description:`Une grande salle à manger avec une table imposante...`,background:null,choices:[{text:"Examiner la table",destination:"examiner-table-manger"},{text:"Aller vers la porte Est (Fumoir)",destination:"fumoir"},{text:"Aller vers la porte Nord (Cuisine)",destination:"cuisine"},{text:"Aller vers la porte Sud (Galerie Glaces)",destination:"galerie-glaces"},{text:"Aller vers la porte Ouest (Vestibule)",destination:"vestibule"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'salon':{title:"Salon",description:`Un salon élégant avec des fauteuils confortables recouverts de housses...`,background:null,choices:[{text:"Examiner les meubles",destination:"examiner-salon"},{text:"Aller vers la porte Ouest (Fumoir)",destination:"fumoir"},{text:"Aller vers la porte Est (Salle Musique)",destination:"salle-musique"},{text:"Aller vers la porte Sud (Galerie Est)",destination:"galerie-est"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'cour-ecuries':{title:"Cour des écuries",description:`Une cour imprégnée de l'odeur du foin et du cheval... mais il n'y a aucun animal.`,background:null,choices:[{text:"Explorer les écuries",destination:"examiner-ecuries"},{text:"Retourner à la cour d'honneur (Sud)",destination:"cour-honneur"},{text:"Aller vers le verger (Est)",destination:"verger"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'sentier-est':{title:"Sentier Est",description:"Un sentier étroit s'enfonce dans la forêt sombre et silencieuse vers l'est.",background:null,choices:[{text:"Suivre le sentier vers l'Est",destination:"campanile-ruine"},{text:"Retourner à l'allée",destination:"allee"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'sentier-ouest':{title:"Sentier Ouest",description:"Ce sentier tortueux part vers l'ouest, entre des arbres aux formes menaçantes.",background:null,choices:[{text:"Suivre le sentier vers l'Ouest",destination:"cimetiere"},{text:"Retourner à l'allée",destination:"allee"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'sentier-nord':{title:"Sentier Nord",description:"Un chemin peu marqué monte vers le nord, s'éloignant du cimetière.",background:null,choices:[{text:"Continuer vers le Nord",destination:"lisiere-foret"},{text:"Retourner au cimetière",destination:"cimetiere"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'lisiere-foret':{title:"Lisière de la Forêt",description:"Le sentier débouche sur la lisière épaisse de la forêt entourant le château. Continuer semble dangereux.",background:null,choices:[{text:"Retourner sur le sentier nord",destination:"sentier-nord"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'couloir-superieur':{title:"Couloir Supérieur",description:"Un couloir sombre au premier étage, bordé de portes closes (chambres ?). Un escalier descend vers la Galerie Ouest, un autre monte vers le Chemin de Ronde.",background:null,choices:[{text:"Examiner la porte 1",destination:"examiner-porte-num-1"},{text:"Aller vers le Boudoir",destination:"boudoir-mortuaire"},{text:"Aller vers la Chapelle",destination:"chapelle-chateau"},{text:"Descendre vers la Galerie Ouest",destination:"galerie-ouest"},{text:"Monter vers le Chemin de Ronde",destination:"chemin-ronde"},{text:"Descendre par l'escalier de service (Cuisine)",destination:"cuisine"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'dependances':{title:"Dépendances",description:"Plusieurs petits bâtiments de service (remise, bûcher...) adossés au mur ouest de la cour. Ils semblent peu utilisés.",background:null,choices:[{text:"Fouiller les dépendances",destination:"fouiller-dependances"},{text:"Retourner à la Cour d'Honneur",destination:"cour-honneur"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'chemin-ronde':{title:"Chemin de Ronde",description:"Vous êtes sur le chemin de ronde du château. La vue est étendue mais le vent siffle sinistrement. Certaines sections sont écroulées.",background:null,choices:[{text:"Observer les alentours",destination:"observer-chemin-ronde"},{text:"Descendre vers le couloir supérieur",destination:"couloir-superieur"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'antre-pretre':{title:"Antre du Prêtre",description:"Une minuscule cachette secrète, à peine assez grande pour tenir debout. Une forte odeur d'ail et des crucifix sur les murs.",background:null,choices:[{text:"Examiner les lieux",destination:"examiner-antre-pretre"},{text:"Sortir (retour Crypte)",destination:"crypte-dracula"},{text:"Rechercher un autre passage secret",action:"searchSecret"}]},
            'galerie-glaces':{title:"Galerie des Glaces",description:"Une pièce entièrement tapissée de miroirs qui renvoient votre reflet (ou son absence ?) à l'infini. La lumière est éblouissante.",background:null,choices:[{text:"Examiner les miroirs",destination:"examiner-glaces"},{text:"Sortir vers la Salle à Manger",destination:"salle-manger"},{text:"Rechercher un passage secret",action:"searchSecret"}]},
            'verger':{title:"Verger",description:"Un ancien verger à l'abandon. Les arbres sont noueux et les fruits rabougris.",background:null,choices:[{text:"Examiner les arbres",destination:"examiner-verger"},{text:"Retourner à la cour des écuries (Ouest)",destination:"cour-ecuries"},{text:"Rechercher un passage secret",action:"searchSecret"}]}
        },
        narratives: {
            'examiner-cercueils':{text:`Vous vous penchez sur les cercueils : ils semblent vides… à part peut-être une légère impression de mouvement dans l'un d'eux ?`,choices:[{text:"Retourner dans le boudoir",destination:"boudoir-mortuaire"}]},
            'examiner-autel':{text:`L’autel est orné de symboles religieux puissants et semble rayonner d'une faible aura protectrice. Un petit flacon de cristal est posé dessus.`,choices:[{text:"Prendre le flacon et retourner à la chapelle",destination:"chapelle-chateau"}],itemGained:{name:"Parfum sacré",type:"potion",effect:{type:"repel-undead",value:3},singleUse:true}},
            'explorer-dedale':{text:`Les tunnels se ressemblent tous, l'air est vicié et vous entendez des grattements inquiétants...`,choices:[{text:"Continuer malgré tout",destination:"dedale-necrophages"},{text:"Faire demi-tour",destination:"crypte-dracula"}]},
            'examiner-mannequins':{text:`En vous approchant, vous réalisez à quel point chaque scène semble figée, presque trop parfaite. Un frisson vous parcourt.`,choices:[{text:"Examiner le chaudron de cire",destination:"examiner-chaudron"},{text:"Retourner au Cabinet",destination:"cabinet-cire"}]},
            'examiner-chaudron':{text:`La cire fond lentement, dégageant une odeur douceâtre. Quelque chose brille faiblement au fond du liquide épais...`,choices:[{text:"Prendre la clé et retourner au Cabinet",destination:"cabinet-cire"}],itemGained:{name:"Clé n°7",type:"key",number:7}},
            'examiner-portail':{text:`Vous examinez attentivement les grilles massives. Elles semblent anciennes mais solides. Une serrure complexe est visible.`,choices:[{text:"Pousser la grille (elle n'est pas verrouillée) et prendre l'allée",destination:"allee"},{text:"Rester devant le portail",destination:"portail"}]},
            'examiner-tombes':{text:`Vous examinez les pierres tombales érodées. La plupart des noms sont illisibles, mais l'atmosphère est lourde et oppressante.`,choices:[{text:"Retourner au cimetière",destination:"cimetiere"}]},
            'examiner-sarcophage':{text:`Le sarcophage de granite contient un cercueil d'ébène parfaitement ajusté. Il semble incroyablement lourd et scellé par une force invisible. C'est votre lieu de repos.`,choices:[{text:"Retourner à la crypte",destination:"crypte-dracula"}],requiredCharacter:"dracula"},
            'teleport-options':{text:`Où souhaitez-vous vous téléporter ? (Coûte 1 PSI)`,choices:[{text:"Salle de musique",destination:"salle-musique"},{text:"Jardin clos",destination:"jardin-clos"},{text:"Cour intérieure",destination:"cour-interieure"},{text:"Annuler",destination:"crypte-dracula"}]},
            'frapper-porte':{text:`Vous frappez lourdement à la porte massive. Le son résonne étrangement, mais personne ne répond. Un silence oppressant s'installe.`,choices:[{text:"Tenter d'ouvrir la porte",destination:"ouvrir-porte"},{text:"Retourner dans la cour d'honneur",destination:"cour-honneur"}]},
            'ouvrir-porte':{text:`Vous poussez la lourde porte. Elle pivote lentement vers l'intérieur en grinçant sinistrement, révélant un vestibule sombre.`,choices:[{text:"Entrer dans le château",destination:"vestibule"}]},
            'cueillir-plantes':{text:`Vous reconnaissez quelques herbes aux propriétés médicinales étranges, bien que potentiellement toxiques. Vous en cueillez prudemment quelques-unes.`,choices:[{text:"Retourner au jardin",destination:"jardin-contrebas"}],itemGained:{name:"Plantes médicinales",type:"potion",effect:{type:"health",value:20},singleUse:true}},
            'examiner-piano':{text:`Vous vous approchez du piano à queue couvert de poussière. Les touches sont jaunies. Vous remarquez un petit compartiment secret sur le côté.`,choices:[{text:"Ouvrir le compartiment",destination:"compartiment-piano"},{text:"Jouer quelques notes",destination:"jouer-piano"},{text:"Retourner à la salle de musique",destination:"salle-musique"}]},
            'jouer-piano':{text:`Vous jouez quelques notes hésitantes. Le son est désaccordé et lugubre, résonnant étrangement dans la pièce silencieuse.`,choices:[{text:"Examiner le compartiment",destination:"compartiment-piano"},{text:"Retourner à la salle de musique",destination:"salle-musique"}]},
            'compartiment-piano':{text:`Dans le compartiment secret, vous trouvez une petite clé en argent finement ciselée.`,choices:[{text:"Prendre la clé et retourner à la salle de musique",destination:"salle-musique"}],itemGained:{name:"Clé n°3",type:"key",number:3}},
            'examiner-vitrine':{text:`La vitrine fermée à clé expose plusieurs armes anciennes : pistolets à silex, épées rouillées, et un poignard orné d'une gemme sombre.`,choices:[{text:"Tenter de forcer la vitrine (test FOR)",action:"forceVitrine"},{text:"Prendre le poignard (si vitrine ouverte)",destination:"prendre-poignard",condition:"vitrine_ouverte"},{text:"Retourner au fumoir",destination:"fumoir"}]},
            'prendre-poignard':{text:`Vous prenez le poignard orné. La gemme semble vous observer froidement.`,choices:[{text:"Retourner au fumoir",destination:"fumoir"}],itemGained:{name:"Poignard orné",type:"weapon",damage:5,special:"possible_curse"}},
            'combat-zombie':{text:"La grille grince et s'ouvre. En entrant dans le caveau, une forme titubante se lève d'une alcôve sombre... Un zombie aux orbites vides se jette sur vous !",triggerCombat:'zombie',choices:[{text:"Retourner au cimetière (après combat)",destination:"cimetiere"}]},
            'examiner-table-vestibule':{text:"La lourde table en chêne est recouverte d'une épaisse couche de poussière. Il n'y a rien dessus d'intéressant.",choices:[{text:"Retourner dans le vestibule",destination:"vestibule"}]},
            'examiner-cuisine':{text:"Les ustensiles sont rouillés, les fourneaux éteints depuis des lustres. Quelques os non identifiables traînent dans un coin.",choices:[{text:"Retourner dans la cuisine",destination:"cuisine"}]},
            'examiner-bibliotheque':{text:"Les livres traitent principalement d'histoire locale, d'occultisme et de généalogie. Beaucoup semblent très anciens et fragiles.",choices:[{text:"Retourner dans la bibliothèque",destination:"bibliotheque"}]},
            'examiner-bureau-biblio':{text:"Le bureau est couvert de vieux parchemins et de cartes de la région. Un encrier séché et une plume usée complètent le tableau.",choices:[{text:"Retourner dans la bibliothèque",destination:"bibliotheque"}]},
            'examiner-table-manger':{text:"La longue table de banquet est vide, à l'exception de chandeliers en argent terni et de quelques assiettes ébréchées.",choices:[{text:"Retourner dans la salle à manger",destination:"salle-manger"}]},
            'examiner-salon':{text:"Les fauteuils sont confortables mais sentent le renfermé. Les bibliothèques contiennent des ouvrages reliés en cuir, mais rien de remarquable.",choices:[{text:"Retourner dans le salon",destination:"salon"}]},
            'examiner-ecuries':{text:"Les boxes sont vides, sentant le vieux foin et la poussière. Quelques outils agricoles rouillés sont accrochés aux murs.",choices:[{text:"Retourner dans la cour des écuries",destination:"cour-ecuries"}]},
            'examiner-glaces':{text:"Votre reflet (ou son absence si vous êtes Dracula) danse dans les multiples miroirs. La pièce semble plus grande qu'elle ne l'est. C'est désorientant.",choices:[{text:"Retourner dans la galerie des glaces",destination:"galerie-glaces"}]},
            'chercher-sortie-jardin-clos':{text:"Vous cherchez une issue dans ce jardin clos envahi par la végétation. Vous trouvez une vieille porte en bois dans le mur nord.",choices:[{text:"Essayer la porte nord",destination:"dependances"},{text:"Rester dans le jardin",destination:"jardin-clos"}]},
            'chercher-sortie-cour-interieure':{text:"La cour intérieure semble n'avoir que deux issues : le passage voûté vers la cour des écuries et une porte basse vers le sud.",choices:[{text:"Passage vers la cour des écuries",destination:"cour-ecuries"},{text:"Essayer la porte sud",destination:"cuisine"},{text:"Rester dans la cour",destination:"cour-interieure"}]},
            'examiner-porte-num-1':{text:"La porte numéro 1 est en bois sombre et semble solidement verrouillée.",choices:[{text:"Utiliser la clé n°1",destination:"chambre-1",condition:"hasItem('Clé n°1')"},{text:"Retourner dans le couloir",destination:"couloir-superieur"}]},
            'fouiller-dependances':{text:"Vous fouillez les remises poussiéreuses. Vous trouvez de vieux outils, du bois de chauffage, mais rien de valeur ou d'utile pour le moment.",choices:[{text:"Retourner aux dépendances",destination:"dependances"}]},
            'observer-chemin-ronde':{text:"Depuis le chemin de ronde, vous voyez les toits sombres du château, la cour d'honneur en contrebas, et la forêt menaçante qui s'étend à perte de vue.",choices:[{text:"Retourner sur le chemin de ronde",destination:"chemin-ronde"}]},
            'examiner-antre-pretre':{text:"L'endroit est exigu et sent fortement l'ail. Des symboles sacrés sont gravés sur les murs. C'est clairement une cachette contre les vampires.",choices:[{text:"Retourner dans l'antre",destination:"antre-pretre"}]},
            'examiner-verger':{text:"Les pommiers et poiriers sont vieux et tordus. Quelques fruits ratatinés pendent aux branches ou jonchent le sol.",choices:[{text:"Retourner dans le verger",destination:"verger"}]}
        },
        enemies: {
            'zombie': { name: "Zombie", health: 25, maxHealth: 25, stats: { rapidite: 1, courage: 6, force: 3, habilete: 2, psi: 0 }, specialEffects: [ { trigger: "roll", value: [11, 12], effect: "mycose", damage: 5 } ], loot: { name: "Élixir de Régénération", type: "potion", effect: { type: "health", value: 50 }, singleUse: true } },
            'loup': { name: "Loup", health: 25, maxHealth: 25, stats: { rapidite: 5, courage: 5, force: 4, habilete: 5, psi: 0 } },
            'chauve-souris-vampire': { name: "Chauve-souris vampire", health: 10, maxHealth: 10, stats: { rapidite: 4, courage: 3, force: 2, habilete: 1, psi: 0 } },
            'main-diable': { name: "Main du Diable", health: 44, maxHealth: 44, stats: { rapidite: 6, courage: 6, force: 6, habilete: 6, psi: 0 }, specialEffects: [ { trigger: "roll", value: [3, 6, 9, 12], effect: "strangulation", damage: 10 } ] },
            'fille-dracula': { name: "Fille de Dracula", health: 25, maxHealth: 25, stats: { rapidite: 4, courage: 5, force: 2, habilete: 3, psi: 2 }, specialEffects: [ { trigger: "roll", value: [5, 6], effect: "rayon-refrigerant", damage: "half" } ] },
            'van-helsing': { name: "Dr. Abraham van Helsing", health: 100, maxHealth: 100, stats: { rapidite: 4, courage: 6, force: 3, habilete: 5, psi: 6 }, specialEffects: [ { trigger: "psi", effect: "foudre", damage: 20, condition: "roll-6" }, { trigger: "psi", effect: "caducee", heal: true }, { trigger: "psi", effect: "souleve-coeur", skipTurn: true }, { trigger: "psi", effect: "empaleur", damage: 5, extraCondition: "double-6-death" } ] }
        },
        randomEvents: [
            { name: "Tonnerre", description: "Un violent coup de tonnerre retentit...", effect: function() { /* Effet atmosphérique */ }, probability: 0.1 },
            { name: "Grincement", description: "Un grincement inquiétant se fait entendre...", effect: function() { /* Effet atmosphérique */ }, probability: 0.15 },
            { name: "Chauve-souris", description: "Une chauve-souris traverse soudainement la pièce...", effect: function() { /* Effet atmosphérique */ }, probability: 0.1 },
            { name: "Chuchotements", description: "Des chuchotements semblent émaner des murs...", effect: function() { /* Effet atmosphérique */ }, probability: 0.08 },
            { name: "Hurlement de loup", description: "Au loin, un loup hurle à la lune...", effect: function() { /* Effet atmosphérique */ }, probability: 0.12 }
        ],
        secretPassages: {
            "portail": "cour-honneur", "allee": "cimetiere", "cour-honneur": "jardin-clos", "cimetiere": "caveau-famille", "vestibule": "crypte-dracula", "galerie-ouest": "cuisine", "galerie-est": "bibliotheque", "fumoir": "salle-manger", "salon": "galerie-glaces", "cour-ecuries": "verger", "jardin-contrebas": "crypte-dracula", "couloir-superieur": "chemin-ronde", "crypte-dracula": "antre-pretre", "salle-musique": "boudoir-mortuaire", "salle-manger": "cuisine", "bibliotheque": "cabinet-cire", "cuisine": "dependances"
        },
        items: {
            "pieu": { name: "Pieu en bois de pommier", description: "Un pieu taillé dans du bois de pommier...", type: "weapon", damage: 10, specialEffect: { type: "vampire-kill", condition: "double-6" } },
            "crucifix": { name: "Crucifix en argent", description: "Un crucifix en argent béni...", type: "protection", effect: { type: "reduce-damage", value: 5, againstType: "undead" } },
            "ail": { name: "Gousse d'ail", description: "Une gousse d'ail fraîche qui repousse les vampires.", type: "protection", effect: { type: "repel", againstType: "vampire" } },
            "eau-benite": { name: "Fiole d'eau bénite", description: "Une petite fiole d'eau bénite...", type: "weapon", damage: 15, singleUse: true, validTargets: ["undead", "vampire"] },
            "elixir-nostradamus": { name: "Panacée de Nostradamus", description: "Un liquide mystérieux créé par le célèbre prophète...", type: "potion", effect: { type: "health", value: "full" }, singleUse: true },
            "cle-cuivre": { name: "Clé en cuivre", description: "Une ancienne clé en cuivre.", type: "key" },
            "cle-argent": { name: "Clé en argent", description: "Une clé finement ciselée en argent.", type: "key" },
            "cle-or": { name: "Clé en or", description: "Une clé magnifiquement ciselée en or pur.", type: "key" },
            "Clé n°1": { name: "Clé n°1", description: "Ouvre la porte 1.", type: "key", number: 1 },
            "Clé n°2": { name: "Clé n°2", description: "Ouvre la porte 2.", type: "key", number: 2 },
            "Clé n°3": { name: "Clé n°3", description: "Ouvre la porte 3.", type: "key", number: 3 },
            "Clé n°4": { name: "Clé n°4", description: "Ouvre la porte 4.", type: "key", number: 4 },
            "Clé n°5": { name: "Clé n°5", description: "Ouvre la porte 5.", type: "key", number: 5 },
            "Clé n°6": { name: "Clé n°6", description: "Ouvre la porte 6.", type: "key", number: 6 },
            "Clé n°7": { name: "Clé n°7", description: "Ouvre la porte 7.", type: "key", number: 7 },
            "Clé n°8": { name: "Clé n°8", description: "Ouvre la porte 8.", type: "key", number: 8 },
            "Clé n°9": { name: "Clé n°9", description: "Ouvre la porte 9.", type: "key", number: 9 },
            "Clé n°10": { name: "Clé n°10", description: "Ouvre la porte 10.", type: "key", number: 10 },
            "Clé n°11": { name: "Clé n°11", description: "Ouvre la porte 11.", type: "key", number: 11 },
            "Clé n°12": { name: "Clé n°12", description: "Ouvre la porte 12.", type: "key", number: 12 }
        },
        numberedKeys: {
             1: "chambre-1", 2: "chambre-2", 3: "chambre-3", 4: "chambre-4", 5: "chambre-5", 6: "chambre-6", 7: "chambre-7", 8: "chambre-8", 9: "chambre-9", 10: "chambre-10", 11: "chambre-11", 12: "chambre-12"
        }
    }; // FIN DE window.gameData

    // --- LE RESTE DU CODE JAVASCRIPT ---
    /* ... (coller ici tout le JS restant : loadGameState, saveGameState, updateUI, initGame, etc. comme dans la réponse précédente) ... */
    function loadGameState() { try { const savedState = localStorage.getItem('chateauDraculaState'); if (savedState) { window.gameState = JSON.parse(savedState); console.log("État du jeu chargé:", window.gameState); return true; } else { console.warn("Aucun état de jeu trouvé"); return false; } } catch (error) { console.error("Erreur lors du chargement de l'état:", error); return false; } }
    function saveGameState() { if (!window.gameState) { console.error("Impossible de sauvegarder: gameState n'existe pas"); return false; } try { localStorage.setItem('chateauDraculaState', JSON.stringify(window.gameState)); console.log("État du jeu sauvegardé avec succès"); return true; } catch (error) { console.error("Erreur lors de la sauvegarde:", error); return false; } }
    function hasItem(itemNameOrId) { if (!window.gameState || !window.gameState.inventory) return false; return window.gameState.inventory.some(item => { if (typeof item === 'string') { return item === itemNameOrId; } else if (typeof item === 'object' && item !== null) { return item.name === itemNameOrId || item.id === itemNameOrId; } return false; }); }
    function updateCharacterDisplay() { if (!window.gameState || !window.gameState.character) { console.warn("Impossible de mettre à jour l'affichage du personnage: données manquantes"); return; } const charNameElement = document.getElementById('character-name'); const portraitElement = document.getElementById('player-portrait'); if (charNameElement) { let displayedName = "Nom inconnu"; if (window.gameState.character === "jonathan") { displayedName = "Jonathan Harker"; } else if (window.gameState.character === "dracula") { displayedName = "Comte Dracula"; } charNameElement.textContent = displayedName; } if (portraitElement) { let portraitUrl = ""; if (window.gameState.character === "jonathan") { portraitUrl = "https://raw.githubusercontent.com/brizoss/chateau-dracula-assets/f98913b21c18fe694f78179011c1655ccba1fc4c/img/jonathan_harker_portrait.png"; } else if (window.gameState.character === "dracula") { portraitUrl = "https://raw.githubusercontent.com/brizoss/chateau-dracula-assets/a4b296d8cc1c3309159f33e810b303513ca2ce4d/img/chauve-souris.png"; } if (portraitUrl) { portraitElement.style.backgroundImage = `url('${portraitUrl}')`; } else { portraitElement.style.backgroundImage = 'none'; } } }
    function updateStatsDisplay() { if (!window.gameState || !window.gameState.stats) { console.warn("Données de statistiques manquantes"); return; } const stats = ['rapidite', 'courage', 'force', 'habilete', 'psi']; stats.forEach(stat => { const element = document.getElementById(`stat-${stat}`); if (element && window.gameState.stats[stat] !== undefined) { element.textContent = window.gameState.stats[stat]; } }); const healthElement = document.getElementById('health-value'); const maxHealthElement = document.getElementById('max-health-value'); if (healthElement && window.gameState.stats.health !== undefined) { healthElement.textContent = window.gameState.stats.health; } if (maxHealthElement && window.gameState.stats.maxHealth !== undefined) { maxHealthElement.textContent = window.gameState.stats.maxHealth; } const psiMaxElement = document.getElementById('stat-psiMax'); if (psiMaxElement && window.gameState.stats.psiMax !== undefined) { psiMaxElement.textContent = window.gameState.stats.psiMax; } }
    function updateInventoryDisplay() { if (!window.gameState) { console.warn("Données d'inventaire manquantes"); return; } const inventoryList = document.getElementById('player-inventory'); if (!inventoryList) return; inventoryList.innerHTML = ''; if (!window.gameState.inventory || window.gameState.inventory.length === 0) { const emptyItem = document.createElement('li'); emptyItem.textContent = 'Aucun objet'; inventoryList.appendChild(emptyItem); return; } window.gameState.inventory.forEach(itemData => { const listItem = document.createElement('li'); let itemName = 'Objet inconnu'; let itemDescription = null; if (typeof itemData === 'string') { const itemDetails = window.gameData.items[itemData]; if (itemDetails) { itemName = itemDetails.name || itemData; itemDescription = itemDetails.description; } else { itemName = itemData; } } else if (typeof itemData === 'object' && itemData !== null) { itemName = itemData.name || itemData.id || 'Objet inconnu'; itemDescription = itemData.description; if (itemData.id && window.gameData.items[itemData.id]) { const details = window.gameData.items[itemData.id]; itemName = details.name || itemName; itemDescription = details.description || itemDescription; } } listItem.textContent = itemName; if (itemDescription) { listItem.setAttribute('data-tooltip', itemDescription); } inventoryList.appendChild(listItem); }); }
    function updateVisitedLocationsDisplay() { if (!window.gameState) { console.warn("Données de lieux visités manquantes"); return; } const visitedList = document.getElementById('visited-locations'); if (!visitedList) return; visitedList.innerHTML = ''; if (!window.gameState.visitedLocations || window.gameState.visitedLocations.length === 0) { const emptyItem = document.createElement('li'); emptyItem.textContent = 'Aucun lieu'; visitedList.appendChild(emptyItem); return; } const maxVisitedToShow = 10; const locationsToDisplay = window.gameState.visitedLocations.slice(-maxVisitedToShow); locationsToDisplay.forEach(locationId => { const listItem = document.createElement('li'); let locationTitle = locationId; if (window.gameData && window.gameData.locations && window.gameData.locations[locationId]) { locationTitle = window.gameData.locations[locationId].title || locationId; } else if (window.gameData && window.gameData.narratives && window.gameData.narratives[locationId]) { locationTitle = (window.gameData.narratives[locationId].text || locationId).substring(0, 30) + "..."; } listItem.textContent = locationTitle; listItem.style.cursor = 'pointer'; listItem.onclick = () => loadLocation(locationId); visitedList.appendChild(listItem); }); if (window.gameState.visitedLocations.length > maxVisitedToShow) { const moreItem = document.createElement('li'); moreItem.textContent = `... (${window.gameState.visitedLocations.length - maxVisitedToShow} autres)`; moreItem.style.fontStyle = 'italic'; moreItem.style.color = '#aaa'; visitedList.appendChild(moreItem); } }
    function loadLocation(locationId) { console.log(`Chargement de: ${locationId}`); if (!window.gameData) { console.error("Impossible de charger: gameData non disponible"); return; } let dataToDisplay = null; let isNarrative = false; if (window.gameData.locations && window.gameData.locations[locationId]) { dataToDisplay = window.gameData.locations[locationId]; } else if (window.gameData.narratives && window.gameData.narratives[locationId]) { dataToDisplay = window.gameData.narratives[locationId]; isNarrative = true; } if (!dataToDisplay) { console.error(`Location ou Narrative "${locationId}" non trouvée dans gameData`); alert(`Erreur: Impossible de trouver les données pour "${locationId}". Vérifiez gameData.`); return; } const titleElement = document.getElementById('locations-title'); const descriptionElement = document.getElementById('locations-description'); if (titleElement) { if (isNarrative) { titleElement.textContent = dataToDisplay.title || "Situation"; } else { titleElement.textContent = dataToDisplay.title || locationId; } } if (descriptionElement) { descriptionElement.textContent = dataToDisplay.description || dataToDisplay.text || "Détails non disponibles."; } const bgElement = document.getElementById('locations-background'); if (bgElement) { if (!isNarrative && dataToDisplay.background) { bgElement.style.backgroundImage = `url('${dataToDisplay.background}')`; bgElement.style.opacity = 0.35; } else { bgElement.style.opacity = 0.2; } } updateLocationChoices(dataToDisplay, locationId); if (dataToDisplay.itemGained) { gainItem(dataToDisplay.itemGained); } if (window.gameState) { window.gameState.previousLocation = window.gameState.currentLocation; window.gameState.currentLocation = locationId; if (!isNarrative) { if (!window.gameState.visitedLocations) { window.gameState.visitedLocations = []; } if (!window.gameState.visitedLocations.includes(locationId)) { window.gameState.visitedLocations.push(locationId); updateVisitedLocationsDisplay(); } } saveGameState(); } if (dataToDisplay.triggerCombat) { console.log(`Combat déclenché contre : ${dataToDisplay.triggerCombat}`); alert(`Combat déclenché contre ${window.gameData.enemies[dataToDisplay.triggerCombat]?.name || dataToDisplay.triggerCombat} ! (Logique de combat à implémenter)`); } console.log(`"${locationId}" chargé avec succès`); const textContainer = document.querySelector('.text-container'); if(textContainer) textContainer.scrollTop = 0; }
    function gainItem(itemObject) { if (!window.gameState || !window.gameState.inventory) { console.error("Impossible d'ajouter l'item: gameState.inventory non initialisé."); return; } if (hasItem(itemObject.name)) { console.log(`Item "${itemObject.name}" déjà possédé.`); return; } window.gameState.inventory.push(itemObject); console.log("Item ajouté:", itemObject); updateInventoryDisplay(); saveGameState(); alert(`Vous avez obtenu : ${itemObject.name}`); }
    function updateLocationChoices(data, currentLocationId) { const choicesContainer = document.getElementById('choices-container'); if (!choicesContainer) { console.error("choicesContainer non trouvé!"); return; } choicesContainer.innerHTML = ''; if (!data.choices || data.choices.length === 0) { console.warn(`Aucun choix défini pour ${currentLocationId}`); const defaultButton = document.createElement('button'); defaultButton.className = 'choice'; defaultButton.textContent = "Continuer..."; if (window.gameState && window.gameState.previousLocation) { defaultButton.onclick = () => loadLocation(window.gameState.previousLocation); } else { defaultButton.textContent = "Fin (pas de choix)"; defaultButton.disabled = true; } choicesContainer.appendChild(defaultButton); return; } data.choices.forEach(choice => { const button = document.createElement('button'); button.className = 'choice'; const choiceTextSpan = document.createElement('span'); choiceTextSpan.className = 'choice-text'; choiceTextSpan.textContent = choice.text; button.appendChild(choiceTextSpan); let isDisabled = false; let requirementText = null; if (choice.requiredCharacter && window.gameState) { if (window.gameState.character !== choice.requiredCharacter) { isDisabled = true; requirementText = `(Requiert ${choice.requiredCharacter === 'dracula' ? 'Dracula' : 'Harker'})`; } } if (!isDisabled && choice.condition && window.gameState) { if (choice.condition.startsWith("hasItem")) { const itemName = choice.condition.match(/hasItem\('([^']+)'\)/)[1]; if (!hasItem(itemName)) { isDisabled = true; requirementText = `(Requiert ${itemName})`; } } else if (window.gameState.flags && !window.gameState.flags[choice.condition]) { isDisabled = true; } } if (isDisabled) { button.disabled = true; button.classList.add('disabled'); if (requirementText) { const reqSpan = document.createElement('span'); reqSpan.className = 'requirement'; reqSpan.textContent = requirementText; button.appendChild(reqSpan); } } else { if (choice.destination) { button.onclick = () => loadLocation(choice.destination); } else if (choice.action) { if (typeof window[choice.action] === 'function') { button.onclick = () => window[choice.action](choice); } else { console.warn(`Action "${choice.action}" non trouvée. Désactivation du bouton.`); button.textContent += " (Action non définie)"; button.disabled = true; button.classList.add('disabled'); } } else { button.textContent += " (Ne mène nulle part)"; button.disabled = true; button.classList.add('disabled'); } } choicesContainer.appendChild(button); }); }
    function updateUIFromGameState() { updateCharacterDisplay(); updateStatsDisplay(); updateInventoryDisplay(); updateVisitedLocationsDisplay(); }
    function setupUIButtons() { const saveButton = document.getElementById('save-button'); if (saveButton) { saveButton.onclick = function() { const saved = saveGameState(); alert(saved ? "Partie sauvegardée avec succès" : "Erreur lors de la sauvegarde"); }; } const loadButton = document.getElementById('load-button'); if (loadButton) { loadButton.onclick = function() { const loaded = loadGameState(); if (loaded && window.gameState) { updateUIFromGameState(); if (window.gameState.currentLocation) { loadLocation(window.gameState.currentLocation); alert("Partie chargée avec succès"); } else { alert("Partie chargée, mais lieu actuel inconnu. Retour à l'écran de titre?"); window.location.href = "index-html.html"; } } else { alert("Aucune partie sauvegardée trouvée ou erreur lors du chargement."); } }; } const audioButton = document.getElementById('audio-toggle'); if (audioButton) { window.audioEnabled = true; audioButton.textContent = window.audioEnabled ? 'Son' : 'Son (off)'; audioButton.onclick = function() { window.audioEnabled = !window.audioEnabled; audioButton.textContent = window.audioEnabled ? 'Son' : 'Son (off)'; const audioElements = document.querySelectorAll('audio'); audioElements.forEach(audio => { if (window.audioEnabled) { } else { audio.pause(); } }); console.log("Audio " + (window.audioEnabled ? "activé" : "désactivé")); }; } const backButton = document.getElementById('back-to-creation'); if (backButton) { backButton.onclick = function() { if (confirm("Voulez-vous vraiment revenir à l'écran de création ? Toute progression non sauvegardée sera perdue.")) { window.location.href = "index-html.html"; } }; } }
    function initGame() { console.log("Initialisation du jeu..."); const stateLoaded = loadGameState(); if (stateLoaded && window.gameState && window.gameState.character) { updateUIFromGameState(); if (window.gameState.currentLocation) { loadLocation(window.gameState.currentLocation); } else { const startLocation = (window.gameState.character === "dracula") ? "crypte-dracula" : "portail"; console.log(`Aucun lieu sauvegardé, démarrage à: ${startLocation}`); loadLocation(startLocation); } } else { console.warn("Aucun état de jeu valide trouvé, redirection vers la page d'accueil"); alert("Aucune partie valide trouvée. Vous allez être redirigé vers l'écran de création."); window.location.href = "index-html.html"; return; } setupUIButtons(); console.log("Initialisation du jeu terminée."); }
    window.searchSecret = function() { if (!window.gameState || !window.gameState.currentLocation) { alert("Impossible de chercher un passage secret: lieu actuel inconnu."); return; } const currentLocationId = window.gameState.currentLocation; console.log(`Recherche de passage secret depuis: ${currentLocationId}`); const diceRoll = Math.floor(Math.random() * 11) + 2; let requiredRoll = 10; let bonus = 0; if (window.gameState.character === 'dracula') { if (window.gameData.locations[currentLocationId]) bonus = 2; else bonus = 1; } else { bonus = 1; } const finalRoll = diceRoll + bonus; console.log(`Jet de recherche: ${diceRoll} + ${bonus} = ${finalRoll}. Requis: ${requiredRoll}`); if (finalRoll >= requiredRoll && window.gameData.secretPassages[currentLocationId]) { const destination = window.gameData.secretPassages[currentLocationId]; if (window.gameData.locations[destination] || window.gameData.narratives[destination]) { alert(`Vous avez trouvé un passage secret menant à "${window.gameData.locations[destination]?.title || destination}"! (Jet: ${finalRoll})`); loadLocation(destination); } else { alert(`Vous trouvez un passage secret, mais il semble mener nulle part (destination "${destination}" inconnue). (Jet: ${finalRoll})`); console.error(`Passage secret trouvé depuis ${currentLocationId} mais destination "${destination}" non définie dans gameData.`); } } else { alert(`Vous ne trouvez aucun passage secret après une recherche minutieuse. (Jet: ${finalRoll})`); } };
    window.lookAround = function() { alert("Vous regardez attentivement autour de vous, mais rien ne semble particulièrement notable."); };
    window.forceVitrine = function() { if (!window.gameState || !window.gameState.stats) return; const strength = window.gameState.stats.force || 0; const diceRoll = Math.floor(Math.random() * 6) + 1; const success = (diceRoll <= strength); if (success) { alert(`Avec effort, vous parvenez à forcer la vitrine ! (Jet: ${diceRoll} <= FOR: ${strength})`); if(!window.gameState.flags) window.gameState.flags = {}; window.gameState.flags.vitrine_ouverte = true; saveGameState(); loadLocation(window.gameState.currentLocation); } else { alert(`Malgré vos efforts, la vitrine résiste. (Jet: ${diceRoll} > FOR: ${strength})`); } }
    window.loadLocation = loadLocation; window.updateUIFromGameState = updateUIFromGameState; window.saveGameState = saveGameState; window.loadGameState = loadGameState; window.hasItem = hasItem;
    document.addEventListener('DOMContentLoaded', initGame);

  </script>
</body>
</html>